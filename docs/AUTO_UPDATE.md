# Auto-Update Setup Guide

ClaudeTerminal includes built-in auto-update functionality using Tauri's updater plugin.

## How It Works

1. **On Startup**: The app checks for updates 3 seconds after launch
2. **Background Download**: If an update is available, it downloads in the background
3. **User Notification**: A banner appears notifying the user of the available update
4. **One-Click Update**: User can download and install with a single click
5. **Restart to Apply**: After download, a restart applies the update

## Setup for Developers

### 1. Generate Signing Keys

The updater requires signed updates to ensure security. Generate keys using:

```bash
# Install Tauri CLI if not already installed
npm install -g @tauri-apps/cli

# Generate signing keys
tauri signer generate -w ~/.tauri/claude-terminal.key
```

This creates:
- `~/.tauri/claude-terminal.key` - Private key (keep secret!)
- `~/.tauri/claude-terminal.key.pub` - Public key

### 2. Configure GitHub Secrets

Add these secrets to your GitHub repository (Settings > Secrets > Actions):

- `TAURI_SIGNING_PRIVATE_KEY`: Contents of the private key file
- `TAURI_SIGNING_PRIVATE_KEY_PASSWORD`: Password used when generating the key

### 3. Update Public Key in Config

Replace the `pubkey` in `src-tauri/tauri.conf.json` with your generated public key:

```json
{
  "plugins": {
    "updater": {
      "pubkey": "YOUR_PUBLIC_KEY_HERE",
      "endpoints": [
        "https://github.com/YOUR_USERNAME/claude-terminal/releases/latest/download/latest.json"
      ]
    }
  }
}
```

### 4. Create a Release

Releases are created automatically when you push a tag:

```bash
# Tag a new version
git tag v1.2.0
git push origin v1.2.0
```

Or manually trigger the workflow from GitHub Actions.

## Update Manifest Format

The `latest.json` file is automatically generated by the GitHub Action and follows this format:

```json
{
  "version": "1.2.0",
  "notes": "Release notes here",
  "pub_date": "2024-01-15T12:00:00Z",
  "platforms": {
    "windows-x86_64": {
      "signature": "SIGNATURE_HERE",
      "url": "https://github.com/user/repo/releases/download/v1.2.0/ClaudeTerminal_1.2.0_x64-setup.nsis.zip"
    }
  }
}
```

## User Experience

### Update Available
When an update is available, users see:
- A notification banner at the top of the app
- The option to download now or dismiss for later
- Update information in Settings > App Updates

### Downloading
- Progress bar shows download status
- Download happens in the background
- User can continue using the app

### Ready to Install
- Banner prompts user to restart
- Clicking "Restart Now" applies the update
- User can dismiss and restart manually later

## Troubleshooting

### Update Check Fails
- Verify internet connection
- Check if GitHub releases endpoint is accessible
- Ensure the `latest.json` file exists in the latest release

### Signature Verification Fails
- Ensure the public key in config matches the private key used to sign
- Regenerate keys if necessary
- Check that GitHub secrets are correctly set

### Download Fails
- Check available disk space
- Verify the download URL is accessible
- Check firewall/antivirus settings

## Testing Updates Locally

For local testing, you can:

1. Build a release version: `npm run tauri build`
2. Host `latest.json` locally or use a test server
3. Update the endpoint URL temporarily for testing
